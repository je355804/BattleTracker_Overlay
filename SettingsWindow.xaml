<Window x:Class="BattleTrackerOverlay.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings"
        Width="700"
        Height="1000"
        MaxHeight="1000"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterOwner"
        MinWidth="600"
        MinHeight="400"
        Background="#FF1E1E1E"
        Foreground="White">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main TabControl with UI Options and Metrics Options -->
        <TabControl Grid.Row="0" Background="Transparent">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Foreground" Value="#FFEEEEEE"/>
                    <Setter Property="Padding" Value="24,10"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="FontSize" Value="14"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="Bd"
                                        Background="#FF2F2F2F"
                                        BorderBrush="#FF3F3F3F"
                                        BorderThickness="1"
                                        CornerRadius="8,8,0,0"
                                        Margin="0,0,6,0"
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      ContentSource="Header"
                                                      RecognizesAccessKey="True"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#FF3A3A3A"/>
                                        <Setter TargetName="Bd" Property="BorderBrush" Value="#FF555555"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>
            
            <!-- UI Options Tab -->
            <TabItem Header="UI Options">
                <Border Background="#FF262626" BorderBrush="#FF3B3B3B" BorderThickness="1" CornerRadius="6" Padding="20">
                    <StackPanel>
                        <!-- Opacity Slider -->
                        <TextBlock Text="Overlay Opacity" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,20">
                            <Slider Width="300"
                                    Margin="0,0,12,0"
                                    Minimum="0.5"
                                    Maximum="1.0"
                                    SmallChange="0.05"
                                    LargeChange="0.1"
                                    Value="{Binding OverlayOpacity, Mode=TwoWay}"/>
                            <TextBlock VerticalAlignment="Center"
                                       Text="{Binding OverlayOpacity, StringFormat={}{0:P0}}"
                                       MinWidth="50"/>
                        </StackPanel>

                        <!-- Font Size Slider -->
                        <TextBlock Text="Font Size" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,20">
                            <Slider Width="300"
                                    Margin="0,0,12,0"
                                    Minimum="10"
                                    Maximum="20"
                                    SmallChange="0.5"
                                    LargeChange="1"
                                    TickFrequency="0.5"
                                    IsSnapToTickEnabled="True"
                                    Value="{Binding FontSize, Mode=TwoWay}"/>
                            <TextBlock VerticalAlignment="Center"
                                       Text="{Binding FontSize, StringFormat={}{0:F1}}"
                                       MinWidth="50"/>
                        </StackPanel>

                        <!-- Compact Layout Option -->
                        <CheckBox x:Name="CompactLayoutCheckbox"
                                  IsChecked="{Binding UseCompactLayout, Mode=TwoWay}"
                                  Margin="0,0,0,12">
                            <TextBlock Text="Use compact layout (card view)" FontSize="14" FontWeight="SemiBold" Margin="4,0,0,0"/>
                        </CheckBox>

                        <!-- Column Count Radio Buttons (only visible when compact is checked) -->
                        <StackPanel Margin="24,0,0,0">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding UseCompactLayout}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            
                            <TextBlock Text="Metrics per row:" FontSize="12" Foreground="#FFAAAAAA" Margin="0,0,0,8"/>
                            
                            <RadioButton GroupName="CompactColumns" 
                                         IsChecked="{Binding CompactLayoutColumns, Converter={StaticResource IntToBoolConverter}, ConverterParameter=3}"
                                         Margin="0,0,0,6">
                                <TextBlock Text="3 columns (wide layout)" FontSize="13" Margin="4,0,0,0"/>
                            </RadioButton>
                            
                            <RadioButton GroupName="CompactColumns"
                                         IsChecked="{Binding CompactLayoutColumns, Converter={StaticResource IntToBoolConverter}, ConverterParameter=6}"
                                         Margin="0,0,0,6">
                                <TextBlock Text="6 columns (compact layout)" FontSize="13" Margin="4,0,0,0"/>
                            </RadioButton>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </TabItem>

            <!-- Metrics Options Tab -->
            <TabItem Header="Metrics Options">
                <Border Background="#FF262626" BorderBrush="#FF3B3B3B" BorderThickness="1" CornerRadius="6" Padding="14">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Choose which stats appear in the overlay and customize their headers."
                                   FontSize="12"
                                   Foreground="#FFE4E4E4"
                                   Margin="0,0,0,12"/>

                        <TabControl Grid.Row="1"
                                    x:Name="MetricsTabControl"
                                    Background="Transparent">
                            <TabControl.Resources>
                                <Style TargetType="TabItem">
                                    <Setter Property="Foreground" Value="#FFEEEEEE"/>
                                    <Setter Property="Padding" Value="18,8"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="MinWidth" Value="140"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TabItem">
                                                <Border x:Name="Bd"
                                                        Background="#FF2F2F2F"
                                                        BorderBrush="#FF3F3F3F"
                                                        BorderThickness="1"
                                                        CornerRadius="6,6,0,0"
                                                        Margin="0,0,6,0"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"
                                                                      ContentSource="Header"
                                                                      RecognizesAccessKey="True"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="Bd" Property="Background" Value="#FF3A3A3A"/>
                                                        <Setter TargetName="Bd" Property="BorderBrush" Value="#FF555555"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </Trigger>
                                                    <Trigger Property="IsEnabled" Value="False">
                                                        <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TabControl.Resources>
                            
                            <!-- Global Headers Tab -->
                            <TabItem Header="Global Headers">
                                <Border Background="#FF1F1F1F" BorderBrush="#FF404040" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Grid.Row="0" 
                                                   Text="Edit display names globally. Changes here apply to all tabs."
                                                   FontSize="12"
                                                   Foreground="#FFAAAAAA"
                                                   Margin="0,0,0,10"/>
                                        
                                        <ListView Grid.Row="1"
                                                  x:Name="GlobalHeadersListView"
                                                  ItemsSource="{Binding GlobalHeaders}"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  HorizontalContentAlignment="Stretch"
                                                  AllowDrop="True"
                                                  PreviewMouseLeftButtonDown="GlobalHeaders_PreviewMouseLeftButtonDown"
                                                  MouseMove="GlobalHeaders_MouseMove"
                                                  DragOver="GlobalHeaders_DragOver"
                                                  Drop="GlobalHeaders_Drop">
                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="ListViewItem">
                                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                    <Setter Property="Cursor" Value="Hand"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="ListViewItem">
                                                                <Border x:Name="Bd"
                                                                        Background="Transparent"
                                                                        BorderBrush="Transparent"
                                                                        BorderThickness="0"
                                                                        Padding="2">
                                                                    <GridViewRowPresenter Content="{TemplateBinding Content}"
                                                                                         Columns="{TemplateBinding GridView.ColumnCollection}"/>
                                                                </Border>
                                                                <ControlTemplate.Triggers>
                                                                    <Trigger Property="IsSelected" Value="True">
                                                                        <Setter TargetName="Bd" Property="Background" Value="#FF3A3A3A"/>
                                                                    </Trigger>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter TargetName="Bd" Property="Background" Value="#33FFFFFF"/>
                                                                    </Trigger>
                                                                    <MultiTrigger>
                                                                        <MultiTrigger.Conditions>
                                                                            <Condition Property="IsSelected" Value="True"/>
                                                                            <Condition Property="IsMouseOver" Value="True"/>
                                                                        </MultiTrigger.Conditions>
                                                                        <Setter TargetName="Bd" Property="Background" Value="#FF4A4A4A"/>
                                                                    </MultiTrigger>
                                                                </ControlTemplate.Triggers>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </ListView.ItemContainerStyle>
                                            <ListView.View>
                                                <GridView>
                                                    <GridViewColumn Header="Field" Width="250" DisplayMemberBinding="{Binding Key}"/>
                                                    <GridViewColumn Header="Display Name" Width="250">
                                                        <GridViewColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBox Text="{Binding Header, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                         MinWidth="200"
                                                                         Background="#FFEEEEEE"
                                                                         Foreground="Black"/>
                                                            </DataTemplate>
                                                        </GridViewColumn.CellTemplate>
                                                    </GridViewColumn>
                                                </GridView>
                                            </ListView.View>
                                        </ListView>
                                    </Grid>
                                </Border>
                            </TabItem>
                            
                            <!-- Cumulative Tab -->
                            <TabItem Header="Cumulative" x:Name="CumulativeTab">
                                <Border Background="#FF1F1F1F" BorderBrush="#FF404040" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                            <Button Content="Select All" 
                                                    Width="100" 
                                                    Margin="0,0,8,0"
                                                    Click="SelectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <Button Content="Deselect All" 
                                                    Width="100"
                                                    Click="DeselectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                        </StackPanel>
                                        
                                        <ListView Grid.Row="1"
                                                  ItemsSource="{Binding Metrics}"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  HorizontalContentAlignment="Stretch">
                                            <ListView.View>
                                                <GridView>
                                                    <GridViewColumn Header="Show" Width="80">
                                                        <GridViewColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}" HorizontalAlignment="Center"/>
                                                            </DataTemplate>
                                                        </GridViewColumn.CellTemplate>
                                                    </GridViewColumn>
                                                    <GridViewColumn Header="Field" Width="300" DisplayMemberBinding="{Binding Key}"/>
                                                </GridView>
                                            </ListView.View>
                                        </ListView>
                                    </Grid>
                                </Border>
                            </TabItem>
                            
                            <!-- Current Combat Tab -->
                            <TabItem Header="Current Combat" x:Name="CurrentCombatTab">
                                <Border Background="#FF1F1F1F" BorderBrush="#FF404040" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                            <Button Content="Select All" 
                                                    Width="100" 
                                                    Margin="0,0,8,0"
                                                    Click="SelectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <Button Content="Deselect All" 
                                                    Width="100"
                                                    Click="DeselectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                        </StackPanel>
                                        
                                        <ListView Grid.Row="1"
                                                  ItemsSource="{Binding Metrics}"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  HorizontalContentAlignment="Stretch">
                                            <ListView.View>
                                                <GridView>
                                                    <GridViewColumn Header="Show" Width="80">
                                                        <GridViewColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}" HorizontalAlignment="Center"/>
                                                            </DataTemplate>
                                                        </GridViewColumn.CellTemplate>
                                                    </GridViewColumn>
                                                    <GridViewColumn Header="Field" Width="300" DisplayMemberBinding="{Binding Key}"/>
                                                </GridView>
                                            </ListView.View>
                                        </ListView>
                                    </Grid>
                                </Border>
                            </TabItem>
                            
                            <!-- Current Level Tab -->
                            <TabItem Header="Current Level" x:Name="CurrentLevelTab">
                                <Border Background="#FF1F1F1F" BorderBrush="#FF404040" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                            <Button Content="Select All" 
                                                    Width="100" 
                                                    Margin="0,0,8,0"
                                                    Click="SelectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <Button Content="Deselect All" 
                                                    Width="100"
                                                    Click="DeselectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                        </StackPanel>
                                        
                                        <ListView Grid.Row="1"
                                                  ItemsSource="{Binding Metrics}"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  HorizontalContentAlignment="Stretch">
                                            <ListView.View>
                                                <GridView>
                                                    <GridViewColumn Header="Show" Width="80">
                                                        <GridViewColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}" HorizontalAlignment="Center"/>
                                                            </DataTemplate>
                                                        </GridViewColumn.CellTemplate>
                                                    </GridViewColumn>
                                                    <GridViewColumn Header="Field" Width="300" DisplayMemberBinding="{Binding Key}"/>
                                                </GridView>
                                            </ListView.View>
                                        </ListView>
                                    </Grid>
                                </Border>
                            </TabItem>
                            
                            <!-- Custom 1 Tab -->
                            <TabItem x:Name="Custom1Tab" Header="{Binding DataContext.Custom1Name, RelativeSource={RelativeSource AncestorType=Window}}">
                                <Border Background="#FF1F1F1F" BorderBrush="#FF404040" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                            <Button Content="Select All" 
                                                    Width="100" 
                                                    Margin="0,0,8,0"
                                                    Click="SelectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <Button Content="Deselect All" 
                                                    Width="100"
                                                    Margin="0,0,8,0"
                                                    Click="DeselectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <TextBox x:Name="Custom1NameTextBox"
                                                     Text="{Binding DataContext.Custom1Name, RelativeSource={RelativeSource AncestorType=Window}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                     Width="150"
                                                     Background="#FF2F2F2F"
                                                     Foreground="White"
                                                     BorderBrush="#FF555555"
                                                     BorderThickness="1"
                                                     Padding="6,4"
                                                     VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <ListView Grid.Row="1"
                                                  ItemsSource="{Binding Metrics}"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  HorizontalContentAlignment="Stretch">
                                            <ListView.View>
                                                <GridView>
                                                    <GridViewColumn Header="Show" Width="80">
                                                        <GridViewColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}" HorizontalAlignment="Center"/>
                                                            </DataTemplate>
                                                        </GridViewColumn.CellTemplate>
                                                    </GridViewColumn>
                                                    <GridViewColumn Header="Field" Width="300" DisplayMemberBinding="{Binding Key}"/>
                                                </GridView>
                                            </ListView.View>
                                        </ListView>
                                    </Grid>
                                </Border>
                            </TabItem>
                            
                            <!-- Custom 2 Tab -->
                            <TabItem x:Name="Custom2Tab" Header="{Binding DataContext.Custom2Name, RelativeSource={RelativeSource AncestorType=Window}}">
                                <Border Background="#FF1F1F1F" BorderBrush="#FF404040" BorderThickness="1" CornerRadius="6" Padding="10">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                            <Button Content="Select All" 
                                                    Width="100" 
                                                    Margin="0,0,8,0"
                                                    Click="SelectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <Button Content="Deselect All" 
                                                    Width="100"
                                                    Margin="0,0,8,0"
                                                    Click="DeselectAll_Click"
                                                    Background="#FF3A3A3A"
                                                    Foreground="White"
                                                    BorderBrush="#FF555555"/>
                                            <TextBox x:Name="Custom2NameTextBox"
                                                     Text="{Binding DataContext.Custom2Name, RelativeSource={RelativeSource AncestorType=Window}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                     Width="150"
                                                     Background="#FF2F2F2F"
                                                     Foreground="White"
                                                     BorderBrush="#FF555555"
                                                     BorderThickness="1"
                                                     Padding="6,4"
                                                     VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <ListView Grid.Row="1"
                                                  ItemsSource="{Binding Metrics}"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  HorizontalContentAlignment="Stretch">
                                            <ListView.View>
                                                <GridView>
                                                    <GridViewColumn Header="Show" Width="80">
                                                        <GridViewColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}" HorizontalAlignment="Center"/>
                                                            </DataTemplate>
                                                        </GridViewColumn.CellTemplate>
                                                    </GridViewColumn>
                                                    <GridViewColumn Header="Field" Width="300" DisplayMemberBinding="{Binding Key}"/>
                                                </GridView>
                                            </ListView.View>
                                        </ListView>
                                    </Grid>
                                </Border>
                            </TabItem>
                        </TabControl>
                    </Grid>
                </Border>
            </TabItem>
        </TabControl>

        <!-- Bottom buttons -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="Apply"
                    Width="90"
                    Margin="0,0,12,0"
                    IsDefault="True"
                    Click="Save_Click"
                    Background="#FF4C5BD4"
                    Foreground="White"
                    BorderBrush="#FF6F8AFB"/>
            <Button Content="Close"
                    Width="90"
                    IsCancel="True"
                    Background="#FF2F2F2F"
                    Foreground="White"
                    BorderBrush="#FF555555"/>
        </StackPanel>
    </Grid>
</Window>
